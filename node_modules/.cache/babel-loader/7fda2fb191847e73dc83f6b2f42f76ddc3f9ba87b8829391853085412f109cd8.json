{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst path = require(\"path\");\n\n/** @typedef {import(\"../../declarations/WebpackOptions\").WatchOptions} WatchOptions */\n/** @typedef {import(\"../FileSystemInfo\").FileSystemInfoEntry} FileSystemInfoEntry */\n\n/**\n * @template T\n * @typedef {Object} IStatsBase\n * @property {() => boolean} isFile\n * @property {() => boolean} isDirectory\n * @property {() => boolean} isBlockDevice\n * @property {() => boolean} isCharacterDevice\n * @property {() => boolean} isSymbolicLink\n * @property {() => boolean} isFIFO\n * @property {() => boolean} isSocket\n * @property {T} dev\n * @property {T} ino\n * @property {T} mode\n * @property {T} nlink\n * @property {T} uid\n * @property {T} gid\n * @property {T} rdev\n * @property {T} size\n * @property {T} blksize\n * @property {T} blocks\n * @property {T} atimeMs\n * @property {T} mtimeMs\n * @property {T} ctimeMs\n * @property {T} birthtimeMs\n * @property {Date} atime\n * @property {Date} mtime\n * @property {Date} ctime\n * @property {Date} birthtime\n */\n\n/**\n * @typedef {IStatsBase<number>} IStats\n */\n\n/**\n * @typedef {IStatsBase<bigint> & { atimeNs: bigint, mtimeNs: bigint, ctimeNs: bigint, birthtimeNs: bigint  }} IBigIntStats\n */\n\n/**\n * @typedef {Object} Dirent\n * @property {() => boolean} isFile\n * @property {() => boolean} isDirectory\n * @property {() => boolean} isBlockDevice\n * @property {() => boolean} isCharacterDevice\n * @property {() => boolean} isSymbolicLink\n * @property {() => boolean} isFIFO\n * @property {() => boolean} isSocket\n * @property {string} name\n * @property {string} path\n */\n\n/** @typedef {string | number | boolean | null} JsonPrimitive */\n/** @typedef {JsonValue[]} JsonArray */\n/** @typedef {JsonPrimitive | JsonObject | JsonArray} JsonValue */\n/** @typedef {{[Key in string]: JsonValue} & {[Key in string]?: JsonValue | undefined}} JsonObject */\n\n/** @typedef {function(NodeJS.ErrnoException | null): void} NoParamCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, string=): void} StringCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, Buffer=): void} BufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string | Buffer)=): void} StringOrBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string[])=): void} ReaddirStringCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (Buffer[])=): void} ReaddirBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string[] | Buffer[])=): void} ReaddirStringOrBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (Dirent[])=): void} ReaddirDirentCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, IStats=): void} StatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, IBigIntStats=): void} BigIntStatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (IStats | IBigIntStats)=): void} StatsOrBigIntStatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, number=): void} NumberCallback */\n/** @typedef {function(NodeJS.ErrnoException | Error | null, JsonObject=): void} ReadJsonCallback */\n\n/**\n * @typedef {Object} WatcherInfo\n * @property {Set<string>} changes get current aggregated changes that have not yet send to callback\n * @property {Set<string>} removals get current aggregated removals that have not yet send to callback\n * @property {Map<string, FileSystemInfoEntry | \"ignore\">} fileTimeInfoEntries get info about files\n * @property {Map<string, FileSystemInfoEntry | \"ignore\">} contextTimeInfoEntries get info about directories\n */\n\n// TODO webpack 6 deprecate missing getInfo\n/**\n * @typedef {Object} Watcher\n * @property {function(): void} close closes the watcher and all underlying file watchers\n * @property {function(): void} pause closes the watcher, but keeps underlying file watchers alive until the next watch call\n * @property {function(): Set<string>=} getAggregatedChanges get current aggregated changes that have not yet send to callback\n * @property {function(): Set<string>=} getAggregatedRemovals get current aggregated removals that have not yet send to callback\n * @property {function(): Map<string, FileSystemInfoEntry | \"ignore\">} getFileTimeInfoEntries get info about files\n * @property {function(): Map<string, FileSystemInfoEntry | \"ignore\">} getContextTimeInfoEntries get info about directories\n * @property {function(): WatcherInfo=} getInfo get info about timestamps and changes\n */\n\n/**\n * @callback WatchMethod\n * @param {Iterable<string>} files watched files\n * @param {Iterable<string>} directories watched directories\n * @param {Iterable<string>} missing watched existence entries\n * @param {number} startTime timestamp of start time\n * @param {WatchOptions} options options object\n * @param {function(Error | null, Map<string, FileSystemInfoEntry | \"ignore\">, Map<string, FileSystemInfoEntry | \"ignore\">, Set<string>, Set<string>): void} callback aggregated callback\n * @param {function(string, number): void} callbackUndelayed callback when the first change was detected\n * @returns {Watcher} a watcher\n */\n\n// TODO webpack 6 make optional methods required and avoid using non standard methods like `join`, `relative`, `dirname`, move IntermediateFileSystemExtras methods to InputFilesystem or OutputFilesystem\n\n/**\n * @typedef {string | Buffer | URL} PathLike\n */\n\n/**\n * @typedef {PathLike | number} PathOrFileDescriptor\n */\n\n/**\n * @typedef {Object} ObjectEncodingOptions\n * @property {BufferEncoding | null | undefined} [encoding]\n */\n\n/**\n * @typedef {{\n * (path: PathOrFileDescriptor, options: ({ encoding?: null | undefined, flag?: string | undefined } & import(\"events\").Abortable) | undefined | null, callback: BufferCallback): void;\n * (path: PathOrFileDescriptor, options: ({ encoding: BufferEncoding, flag?: string | undefined } & import(\"events\").Abortable) | BufferEncoding, callback: StringCallback): void;\n * (path: PathOrFileDescriptor, options: (ObjectEncodingOptions & { flag?: string | undefined } & import(\"events\").Abortable) | BufferEncoding | undefined | null, callback: StringOrBufferCallback): void;\n * (path: PathOrFileDescriptor, callback: BufferCallback): void;\n * }} ReadFile\n */\n\n/**\n * @typedef {{\n * (path: PathOrFileDescriptor, options?: { encoding?: null | undefined, flag?: string | undefined } | null): Buffer;\n * (path: PathOrFileDescriptor, options: { encoding: BufferEncoding, flag?: string | undefined } | BufferEncoding): string;\n * (path: PathOrFileDescriptor, options?: (ObjectEncodingOptions & { flag?: string | undefined }) | BufferEncoding | null): string | Buffer;\n * }} ReadFileSync\n */\n\n/**\n * @typedef {ObjectEncodingOptions | BufferEncoding | undefined | null} EncodingOption\n */\n\n/**\n * @typedef {'buffer'| { encoding: 'buffer' }} BufferEncodingOption\n */\n\n/**\n * @typedef {Object} StatOptions\n * @property {(boolean | undefined)=} bigint\n */\n\n/**\n * @typedef {Object} StatSyncOptions\n * @property {(boolean | undefined)=} bigint\n * @property {(boolean | undefined)=} throwIfNoEntry\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: EncodingOption, callback: StringCallback): void;\n * (path: PathLike, options: BufferEncodingOption, callback: BufferCallback): void;\n * (path: PathLike, options: EncodingOption, callback: StringOrBufferCallback): void;\n * (path: PathLike, callback: StringCallback): void;\n * }} Readlink\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: EncodingOption): string;\n * (path: PathLike, options: BufferEncodingOption): Buffer;\n * (path: PathLike, options?: EncodingOption): string | Buffer;\n * }} ReadlinkSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: { encoding: BufferEncoding | null, withFileTypes?: false | undefined, recursive?: boolean | undefined } | BufferEncoding | undefined | null, callback: ReaddirStringCallback): void;\n * (path: PathLike, options: { encoding: 'buffer', withFileTypes?: false | undefined, recursive?: boolean | undefined } | 'buffer', callback: ReaddirBufferCallback): void;\n * (path: PathLike, callback: ReaddirStringCallback): void;\n * (path: PathLike, options: (ObjectEncodingOptions & { withFileTypes?: false | undefined, recursive?: boolean | undefined }) | BufferEncoding | undefined | null, callback: ReaddirStringOrBufferCallback): void;\n * (path: PathLike, options: ObjectEncodingOptions & { withFileTypes: true, recursive?: boolean | undefined }, callback: ReaddirDirentCallback): void;\n * }} Readdir\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: { encoding: BufferEncoding | null, withFileTypes?: false | undefined, recursive?: boolean | undefined } | BufferEncoding | null): string[];\n * (path: PathLike, options: { encoding: 'buffer', withFileTypes?: false | undefined, recursive?: boolean | undefined } | 'buffer'): Buffer[];\n * (path: PathLike, options?: (ObjectEncodingOptions & { withFileTypes?: false | undefined, recursive?: boolean | undefined }) | BufferEncoding | null): string[] | Buffer[];\n * (path: PathLike, options: ObjectEncodingOptions & { withFileTypes: true, recursive?: boolean | undefined }): Dirent[];\n * }} ReaddirSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, callback: StatsCallback): void;\n * (path: PathLike, options: (StatOptions & { bigint?: false | undefined }) | undefined, callback: StatsCallback): void;\n * (path: PathLike, options: StatOptions & { bigint: true }, callback: BigIntStatsCallback): void;\n * (path: PathLike, options: StatOptions | undefined, callback: StatsOrBigIntStatsCallback): void;\n * }} Stat\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: undefined): IStats;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined, throwIfNoEntry: false }): IStats | undefined;\n * (path: PathLike, options: StatSyncOptions & { bigint: true, throwIfNoEntry: false }): IBigIntStats | undefined;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined }): IStats;\n * (path: PathLike, options: StatSyncOptions & { bigint: true }): IBigIntStats;\n * (path: PathLike,  options: StatSyncOptions & { bigint: boolean, throwIfNoEntry?: false | undefined }): IStats | IBigIntStats;\n * (path: PathLike,  options?: StatSyncOptions): IStats | IBigIntStats | undefined;\n * }} StatSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, callback: StatsCallback): void;\n * (path: PathLike, options: (StatOptions & { bigint?: false | undefined }) | undefined, callback: StatsCallback): void;\n * (path: PathLike, options: StatOptions & { bigint: true }, callback: BigIntStatsCallback): void;\n * (path: PathLike, options: StatOptions | undefined, callback: StatsOrBigIntStatsCallback): void;\n * }} LStat\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: undefined): IStats;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined, throwIfNoEntry: false }): IStats | undefined;\n * (path: PathLike, options: StatSyncOptions & { bigint: true, throwIfNoEntry: false }): IBigIntStats | undefined;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined }): IStats;\n * (path: PathLike, options: StatSyncOptions & { bigint: true }): IBigIntStats;\n * (path: PathLike,  options: StatSyncOptions & { bigint: boolean, throwIfNoEntry?: false | undefined }): IStats | IBigIntStats;\n * (path: PathLike,  options?: StatSyncOptions): IStats | IBigIntStats | undefined;\n * }} LStatSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: EncodingOption, callback: StringCallback): void;\n * (path: PathLike, options: BufferEncodingOption, callback: BufferCallback): void;\n * (path: PathLike, options: EncodingOption, callback: StringOrBufferCallback): void;\n * (path: PathLike, callback: StringCallback): void;\n * }} RealPath\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: EncodingOption): string;\n * (path: PathLike, options: BufferEncodingOption): Buffer;\n * (path: PathLike, options?: EncodingOption): string | Buffer;\n * }} RealPathSync\n */\n\n/**\n * @typedef {function(PathOrFileDescriptor, ReadJsonCallback): void} ReadJson\n */\n\n/**\n * @typedef {function(PathOrFileDescriptor): JsonObject} ReadJsonSync\n */\n\n/**\n * @typedef {function((string | string[] | Set<string>)=): void} Purge\n */\n\n/**\n * @typedef {Object} InputFileSystem\n * @property {ReadFile} readFile\n * @property {ReadFileSync=} readFileSync\n * @property {Readlink} readlink\n * @property {ReadlinkSync=} readlinkSync\n * @property {Readdir} readdir\n * @property {ReaddirSync=} readdirSync\n * @property {Stat} stat\n * @property {StatSync=} statSync\n * @property {LStat=} lstat\n * @property {LStatSync=} lstatSync\n * @property {RealPath=} realpath\n * @property {RealPathSync=} realpathSync\n * @property {ReadJson=} readJson\n * @property {ReadJsonSync=} readJsonSync\n * @property {Purge=} purge\n * @property {(function(string, string): string)=} join\n * @property {(function(string, string): string)=} relative\n * @property {(function(string): string)=} dirname\n */\n\n/**\n * @typedef {number | string} Mode\n */\n\n/**\n * @typedef {(ObjectEncodingOptions & import(\"events\").Abortable & { mode?: Mode | undefined, flag?: string | undefined, flush?: boolean | undefined }) | BufferEncoding | null} WriteFileOptions\n */\n\n/**\n * @typedef {{\n * (file: PathOrFileDescriptor, data: string | NodeJS.ArrayBufferView, options: WriteFileOptions, callback: NoParamCallback): void;\n * (file: PathOrFileDescriptor, data: string | NodeJS.ArrayBufferView, callback: NoParamCallback): void;\n * }} WriteFile\n */\n\n/**\n * @typedef {{ recursive?: boolean | undefined, mode?: Mode | undefined }} MakeDirectoryOptions\n */\n\n/**\n * @typedef {{\n * (file: PathLike, options: MakeDirectoryOptions & { recursive: true }, callback: StringCallback): void;\n * (file: PathLike, options: Mode | (MakeDirectoryOptions & { recursive?: false | undefined; }) | null | undefined, callback: NoParamCallback): void;\n * (file: PathLike, options: Mode | MakeDirectoryOptions | null | undefined, callback: StringCallback): void;\n * (file: PathLike, callback: NoParamCallback): void;\n * }} Mkdir\n */\n\n/**\n * @typedef {{ maxRetries?: number | undefined, recursive?: boolean | undefined, retryDelay?: number | undefined }} RmDirOptions\n */\n\n/**\n * @typedef {{\n * (file: PathLike, callback: NoParamCallback): void;\n * (file: PathLike, options: RmDirOptions, callback: NoParamCallback): void;\n * }} Rmdir\n */\n\n/**\n * @typedef {function(PathLike, NoParamCallback): void} Unlink\n */\n\n/**\n * @typedef {Object} OutputFileSystem\n * @property {WriteFile} writeFile\n * @property {Mkdir} mkdir\n * @property {Readdir=} readdir\n * @property {Rmdir=} rmdir\n * @property {Unlink=} unlink\n * @property {Stat} stat\n * @property {LStat=} lstat\n * @property {ReadFile} readFile\n * @property {(function(string, string): string)=} join\n * @property {(function(string, string): string)=} relative\n * @property {(function(string): string)=} dirname\n */\n\n/**\n * @typedef {Object} WatchFileSystem\n * @property {WatchMethod} watch\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: MakeDirectoryOptions & { recursive: true }): string | undefined;\n * (path: PathLike, options?: Mode | (MakeDirectoryOptions & { recursive?: false | undefined }) | null): void;\n * (path: PathLike, options?: Mode | MakeDirectoryOptions | null): string | undefined;\n * }} MkdirSync\n */\n\n/**\n * @typedef {Object} StreamOptions\n * @property {(string | undefined)=} flags\n * @property {(BufferEncoding | undefined)} encoding\n * @property {(number | any | undefined)=} fd\n * @property {(number | undefined)=} mode\n * @property {(boolean | undefined)=} autoClose\n * @property {(boolean | undefined)=} emitClose\n * @property {(number | undefined)=} start\n * @property {(AbortSignal | null | undefined)=} signal\n */\n\n/**\n * @typedef {Object} FSImplementation\n * @property {((...args: any[]) => any)=} open\n * @property {((...args: any[]) => any)=} close\n */\n\n/**\n * @typedef {FSImplementation & { write: (...args: any[]) => any; close?: (...args: any[]) => any }} CreateWriteStreamFSImplementation\n */\n\n/**\n * @typedef {StreamOptions & { fs?: CreateWriteStreamFSImplementation | null | undefined }} WriteStreamOptions\n */\n\n/**\n * @typedef {function(PathLike, (BufferEncoding | WriteStreamOptions)=): NodeJS.WritableStream} CreateWriteStream\n */\n\n/**\n * @typedef {number | string} OpenMode\n */\n\n/**\n * @typedef {{\n * (file: PathLike, flags: OpenMode | undefined,  mode: Mode | undefined | null, callback: NumberCallback): void;\n * (file: PathLike, flags: OpenMode | undefined, callback: NumberCallback): void;\n * (file: PathLike, callback: NumberCallback): void;\n * }} Open\n */\n\n/**\n * @typedef {number | bigint} ReadPosition\n */\n\n/**\n * @typedef {Object} ReadSyncOptions\n * @property {(number | undefined)=} offset\n * @property {(number | undefined)=} length\n * @property {(ReadPosition | null | undefined)=} position\n */\n\n/**\n * @template {NodeJS.ArrayBufferView} TBuffer\n * @typedef {Object} ReadAsyncOptions\n * @property {(number | undefined)=} offset\n * @property {(number | undefined)=} length\n * @property {(ReadPosition | null | undefined)=} position\n * @property {TBuffer=} buffer\n */\n\n/**\n * @template {NodeJS.ArrayBufferView} [TBuffer=Buffer]\n * @typedef {{\n * (fd: number, buffer: TBuffer, offset: number, length: number, position: ReadPosition | null, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: TBuffer) => void): void;\n * (fd: number, options: ReadAsyncOptions<TBuffer>, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: TBuffer) => void): void;\n * (fd: number, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: NodeJS.ArrayBufferView) => void): void;\n * }} Read\n */\n\n/** @typedef {function(number, NoParamCallback): void} Close */\n\n/** @typedef {function(PathLike, PathLike, NoParamCallback): void} Rename */\n\n/**\n * @typedef {Object} IntermediateFileSystemExtras\n * @property {MkdirSync} mkdirSync\n * @property {CreateWriteStream} createWriteStream\n * @property {Open} open\n * @property {Read} read\n * @property {Close} close\n * @property {Rename} rename\n */\n\n/** @typedef {InputFileSystem & OutputFileSystem & IntermediateFileSystemExtras} IntermediateFileSystem */\n\n/**\n *\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} rootPath the root path\n * @param {string} targetPath the target path\n * @returns {string} location of targetPath relative to rootPath\n */\nconst relative = (fs, rootPath, targetPath) => {\n  if (fs && fs.relative) {\n    return fs.relative(rootPath, targetPath);\n  } else if (path.posix.isAbsolute(rootPath)) {\n    return path.posix.relative(rootPath, targetPath);\n  } else if (path.win32.isAbsolute(rootPath)) {\n    return path.win32.relative(rootPath, targetPath);\n  } else {\n    throw new Error(`${rootPath} is neither a posix nor a windows path, and there is no 'relative' method defined in the file system`);\n  }\n};\nexports.relative = relative;\n\n/**\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} rootPath a path\n * @param {string} filename a filename\n * @returns {string} the joined path\n */\nconst join = (fs, rootPath, filename) => {\n  if (fs && fs.join) {\n    return fs.join(rootPath, filename);\n  } else if (path.posix.isAbsolute(rootPath)) {\n    return path.posix.join(rootPath, filename);\n  } else if (path.win32.isAbsolute(rootPath)) {\n    return path.win32.join(rootPath, filename);\n  } else {\n    throw new Error(`${rootPath} is neither a posix nor a windows path, and there is no 'join' method defined in the file system`);\n  }\n};\nexports.join = join;\n\n/**\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} absPath an absolute path\n * @returns {string} the parent directory of the absolute path\n */\nconst dirname = (fs, absPath) => {\n  if (fs && fs.dirname) {\n    return fs.dirname(absPath);\n  } else if (path.posix.isAbsolute(absPath)) {\n    return path.posix.dirname(absPath);\n  } else if (path.win32.isAbsolute(absPath)) {\n    return path.win32.dirname(absPath);\n  } else {\n    throw new Error(`${absPath} is neither a posix nor a windows path, and there is no 'dirname' method defined in the file system`);\n  }\n};\nexports.dirname = dirname;\n\n/**\n * @param {OutputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {function(Error=): void} callback callback function for the error\n * @returns {void}\n */\nconst mkdirp = (fs, p, callback) => {\n  fs.mkdir(p, err => {\n    if (err) {\n      if (err.code === \"ENOENT\") {\n        const dir = dirname(fs, p);\n        if (dir === p) {\n          callback(err);\n          return;\n        }\n        mkdirp(fs, dir, err => {\n          if (err) {\n            callback(err);\n            return;\n          }\n          fs.mkdir(p, err => {\n            if (err) {\n              if (err.code === \"EEXIST\") {\n                callback();\n                return;\n              }\n              callback(err);\n              return;\n            }\n            callback();\n          });\n        });\n        return;\n      } else if (err.code === \"EEXIST\") {\n        callback();\n        return;\n      }\n      callback(err);\n      return;\n    }\n    callback();\n  });\n};\nexports.mkdirp = mkdirp;\n\n/**\n * @param {IntermediateFileSystem} fs a file system\n * @param {string} p an absolute path\n * @returns {void}\n */\nconst mkdirpSync = (fs, p) => {\n  try {\n    fs.mkdirSync(p);\n  } catch (err) {\n    if (err) {\n      if ( /** @type {NodeJS.ErrnoException} */err.code === \"ENOENT\") {\n        const dir = dirname(fs, p);\n        if (dir === p) {\n          throw err;\n        }\n        mkdirpSync(fs, dir);\n        fs.mkdirSync(p);\n        return;\n      } else if ( /** @type {NodeJS.ErrnoException} */err.code === \"EEXIST\") {\n        return;\n      }\n      throw err;\n    }\n  }\n};\nexports.mkdirpSync = mkdirpSync;\n\n/**\n * @param {InputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {ReadJsonCallback} callback callback\n * @returns {void}\n */\nconst readJson = (fs, p, callback) => {\n  if (\"readJson\" in fs) return /** @type {NonNullable<InputFileSystem[\"readJson\"]>} */fs.readJson(p, callback);\n  fs.readFile(p, (err, buf) => {\n    if (err) return callback(err);\n    let data;\n    try {\n      data = JSON.parse( /** @type {Buffer} */buf.toString(\"utf-8\"));\n    } catch (e) {\n      return callback( /** @type {Error} */e);\n    }\n    return callback(null, data);\n  });\n};\nexports.readJson = readJson;\n\n/**\n * @param {InputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {function(NodeJS.ErrnoException | Error | null, (IStats | string)=): void} callback callback\n * @returns {void}\n */\nconst lstatReadlinkAbsolute = (fs, p, callback) => {\n  let i = 3;\n  const doReadLink = () => {\n    fs.readlink(p, (err, target) => {\n      if (err && --i > 0) {\n        // It might was just changed from symlink to file\n        // we retry 2 times to catch this case before throwing the error\n        return doStat();\n      }\n      if (err || !target) return doStat();\n      const value = target.toString();\n      callback(null, join(fs, dirname(fs, p), value));\n    });\n  };\n  const doStat = () => {\n    if (\"lstat\" in fs) {\n      return /** @type {NonNullable<InputFileSystem[\"lstat\"]>} */fs.lstat(p, (err, stats) => {\n        if (err) return callback(err);\n        if ( /** @type {IStats} */stats.isSymbolicLink()) {\n          return doReadLink();\n        }\n        callback(null, stats);\n      });\n    } else {\n      return fs.stat(p, callback);\n    }\n  };\n  if (\"lstat\" in fs) return doStat();\n  doReadLink();\n};\nexports.lstatReadlinkAbsolute = lstatReadlinkAbsolute;","map":{"version":3,"names":["path","require","relative","fs","rootPath","targetPath","posix","isAbsolute","win32","Error","exports","join","filename","dirname","absPath","mkdirp","p","callback","mkdir","err","code","dir","mkdirpSync","mkdirSync","readJson","readFile","buf","data","JSON","parse","toString","e","lstatReadlinkAbsolute","i","doReadLink","readlink","target","doStat","value","lstat","stats","isSymbolicLink","stat"],"sources":["/Volumes/storage/projects/project-mcnt/node_modules/webpack/lib/util/fs.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst path = require(\"path\");\n\n/** @typedef {import(\"../../declarations/WebpackOptions\").WatchOptions} WatchOptions */\n/** @typedef {import(\"../FileSystemInfo\").FileSystemInfoEntry} FileSystemInfoEntry */\n\n/**\n * @template T\n * @typedef {Object} IStatsBase\n * @property {() => boolean} isFile\n * @property {() => boolean} isDirectory\n * @property {() => boolean} isBlockDevice\n * @property {() => boolean} isCharacterDevice\n * @property {() => boolean} isSymbolicLink\n * @property {() => boolean} isFIFO\n * @property {() => boolean} isSocket\n * @property {T} dev\n * @property {T} ino\n * @property {T} mode\n * @property {T} nlink\n * @property {T} uid\n * @property {T} gid\n * @property {T} rdev\n * @property {T} size\n * @property {T} blksize\n * @property {T} blocks\n * @property {T} atimeMs\n * @property {T} mtimeMs\n * @property {T} ctimeMs\n * @property {T} birthtimeMs\n * @property {Date} atime\n * @property {Date} mtime\n * @property {Date} ctime\n * @property {Date} birthtime\n */\n\n/**\n * @typedef {IStatsBase<number>} IStats\n */\n\n/**\n * @typedef {IStatsBase<bigint> & { atimeNs: bigint, mtimeNs: bigint, ctimeNs: bigint, birthtimeNs: bigint  }} IBigIntStats\n */\n\n/**\n * @typedef {Object} Dirent\n * @property {() => boolean} isFile\n * @property {() => boolean} isDirectory\n * @property {() => boolean} isBlockDevice\n * @property {() => boolean} isCharacterDevice\n * @property {() => boolean} isSymbolicLink\n * @property {() => boolean} isFIFO\n * @property {() => boolean} isSocket\n * @property {string} name\n * @property {string} path\n */\n\n/** @typedef {string | number | boolean | null} JsonPrimitive */\n/** @typedef {JsonValue[]} JsonArray */\n/** @typedef {JsonPrimitive | JsonObject | JsonArray} JsonValue */\n/** @typedef {{[Key in string]: JsonValue} & {[Key in string]?: JsonValue | undefined}} JsonObject */\n\n/** @typedef {function(NodeJS.ErrnoException | null): void} NoParamCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, string=): void} StringCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, Buffer=): void} BufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string | Buffer)=): void} StringOrBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string[])=): void} ReaddirStringCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (Buffer[])=): void} ReaddirBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (string[] | Buffer[])=): void} ReaddirStringOrBufferCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (Dirent[])=): void} ReaddirDirentCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, IStats=): void} StatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, IBigIntStats=): void} BigIntStatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, (IStats | IBigIntStats)=): void} StatsOrBigIntStatsCallback */\n/** @typedef {function(NodeJS.ErrnoException | null, number=): void} NumberCallback */\n/** @typedef {function(NodeJS.ErrnoException | Error | null, JsonObject=): void} ReadJsonCallback */\n\n/**\n * @typedef {Object} WatcherInfo\n * @property {Set<string>} changes get current aggregated changes that have not yet send to callback\n * @property {Set<string>} removals get current aggregated removals that have not yet send to callback\n * @property {Map<string, FileSystemInfoEntry | \"ignore\">} fileTimeInfoEntries get info about files\n * @property {Map<string, FileSystemInfoEntry | \"ignore\">} contextTimeInfoEntries get info about directories\n */\n\n// TODO webpack 6 deprecate missing getInfo\n/**\n * @typedef {Object} Watcher\n * @property {function(): void} close closes the watcher and all underlying file watchers\n * @property {function(): void} pause closes the watcher, but keeps underlying file watchers alive until the next watch call\n * @property {function(): Set<string>=} getAggregatedChanges get current aggregated changes that have not yet send to callback\n * @property {function(): Set<string>=} getAggregatedRemovals get current aggregated removals that have not yet send to callback\n * @property {function(): Map<string, FileSystemInfoEntry | \"ignore\">} getFileTimeInfoEntries get info about files\n * @property {function(): Map<string, FileSystemInfoEntry | \"ignore\">} getContextTimeInfoEntries get info about directories\n * @property {function(): WatcherInfo=} getInfo get info about timestamps and changes\n */\n\n/**\n * @callback WatchMethod\n * @param {Iterable<string>} files watched files\n * @param {Iterable<string>} directories watched directories\n * @param {Iterable<string>} missing watched existence entries\n * @param {number} startTime timestamp of start time\n * @param {WatchOptions} options options object\n * @param {function(Error | null, Map<string, FileSystemInfoEntry | \"ignore\">, Map<string, FileSystemInfoEntry | \"ignore\">, Set<string>, Set<string>): void} callback aggregated callback\n * @param {function(string, number): void} callbackUndelayed callback when the first change was detected\n * @returns {Watcher} a watcher\n */\n\n// TODO webpack 6 make optional methods required and avoid using non standard methods like `join`, `relative`, `dirname`, move IntermediateFileSystemExtras methods to InputFilesystem or OutputFilesystem\n\n/**\n * @typedef {string | Buffer | URL} PathLike\n */\n\n/**\n * @typedef {PathLike | number} PathOrFileDescriptor\n */\n\n/**\n * @typedef {Object} ObjectEncodingOptions\n * @property {BufferEncoding | null | undefined} [encoding]\n */\n\n/**\n * @typedef {{\n * (path: PathOrFileDescriptor, options: ({ encoding?: null | undefined, flag?: string | undefined } & import(\"events\").Abortable) | undefined | null, callback: BufferCallback): void;\n * (path: PathOrFileDescriptor, options: ({ encoding: BufferEncoding, flag?: string | undefined } & import(\"events\").Abortable) | BufferEncoding, callback: StringCallback): void;\n * (path: PathOrFileDescriptor, options: (ObjectEncodingOptions & { flag?: string | undefined } & import(\"events\").Abortable) | BufferEncoding | undefined | null, callback: StringOrBufferCallback): void;\n * (path: PathOrFileDescriptor, callback: BufferCallback): void;\n * }} ReadFile\n */\n\n/**\n * @typedef {{\n * (path: PathOrFileDescriptor, options?: { encoding?: null | undefined, flag?: string | undefined } | null): Buffer;\n * (path: PathOrFileDescriptor, options: { encoding: BufferEncoding, flag?: string | undefined } | BufferEncoding): string;\n * (path: PathOrFileDescriptor, options?: (ObjectEncodingOptions & { flag?: string | undefined }) | BufferEncoding | null): string | Buffer;\n * }} ReadFileSync\n */\n\n/**\n * @typedef {ObjectEncodingOptions | BufferEncoding | undefined | null} EncodingOption\n */\n\n/**\n * @typedef {'buffer'| { encoding: 'buffer' }} BufferEncodingOption\n */\n\n/**\n * @typedef {Object} StatOptions\n * @property {(boolean | undefined)=} bigint\n */\n\n/**\n * @typedef {Object} StatSyncOptions\n * @property {(boolean | undefined)=} bigint\n * @property {(boolean | undefined)=} throwIfNoEntry\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: EncodingOption, callback: StringCallback): void;\n * (path: PathLike, options: BufferEncodingOption, callback: BufferCallback): void;\n * (path: PathLike, options: EncodingOption, callback: StringOrBufferCallback): void;\n * (path: PathLike, callback: StringCallback): void;\n * }} Readlink\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: EncodingOption): string;\n * (path: PathLike, options: BufferEncodingOption): Buffer;\n * (path: PathLike, options?: EncodingOption): string | Buffer;\n * }} ReadlinkSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: { encoding: BufferEncoding | null, withFileTypes?: false | undefined, recursive?: boolean | undefined } | BufferEncoding | undefined | null, callback: ReaddirStringCallback): void;\n * (path: PathLike, options: { encoding: 'buffer', withFileTypes?: false | undefined, recursive?: boolean | undefined } | 'buffer', callback: ReaddirBufferCallback): void;\n * (path: PathLike, callback: ReaddirStringCallback): void;\n * (path: PathLike, options: (ObjectEncodingOptions & { withFileTypes?: false | undefined, recursive?: boolean | undefined }) | BufferEncoding | undefined | null, callback: ReaddirStringOrBufferCallback): void;\n * (path: PathLike, options: ObjectEncodingOptions & { withFileTypes: true, recursive?: boolean | undefined }, callback: ReaddirDirentCallback): void;\n * }} Readdir\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: { encoding: BufferEncoding | null, withFileTypes?: false | undefined, recursive?: boolean | undefined } | BufferEncoding | null): string[];\n * (path: PathLike, options: { encoding: 'buffer', withFileTypes?: false | undefined, recursive?: boolean | undefined } | 'buffer'): Buffer[];\n * (path: PathLike, options?: (ObjectEncodingOptions & { withFileTypes?: false | undefined, recursive?: boolean | undefined }) | BufferEncoding | null): string[] | Buffer[];\n * (path: PathLike, options: ObjectEncodingOptions & { withFileTypes: true, recursive?: boolean | undefined }): Dirent[];\n * }} ReaddirSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, callback: StatsCallback): void;\n * (path: PathLike, options: (StatOptions & { bigint?: false | undefined }) | undefined, callback: StatsCallback): void;\n * (path: PathLike, options: StatOptions & { bigint: true }, callback: BigIntStatsCallback): void;\n * (path: PathLike, options: StatOptions | undefined, callback: StatsOrBigIntStatsCallback): void;\n * }} Stat\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: undefined): IStats;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined, throwIfNoEntry: false }): IStats | undefined;\n * (path: PathLike, options: StatSyncOptions & { bigint: true, throwIfNoEntry: false }): IBigIntStats | undefined;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined }): IStats;\n * (path: PathLike, options: StatSyncOptions & { bigint: true }): IBigIntStats;\n * (path: PathLike,  options: StatSyncOptions & { bigint: boolean, throwIfNoEntry?: false | undefined }): IStats | IBigIntStats;\n * (path: PathLike,  options?: StatSyncOptions): IStats | IBigIntStats | undefined;\n * }} StatSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, callback: StatsCallback): void;\n * (path: PathLike, options: (StatOptions & { bigint?: false | undefined }) | undefined, callback: StatsCallback): void;\n * (path: PathLike, options: StatOptions & { bigint: true }, callback: BigIntStatsCallback): void;\n * (path: PathLike, options: StatOptions | undefined, callback: StatsOrBigIntStatsCallback): void;\n * }} LStat\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: undefined): IStats;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined, throwIfNoEntry: false }): IStats | undefined;\n * (path: PathLike, options: StatSyncOptions & { bigint: true, throwIfNoEntry: false }): IBigIntStats | undefined;\n * (path: PathLike, options?: StatSyncOptions & { bigint?: false | undefined }): IStats;\n * (path: PathLike, options: StatSyncOptions & { bigint: true }): IBigIntStats;\n * (path: PathLike,  options: StatSyncOptions & { bigint: boolean, throwIfNoEntry?: false | undefined }): IStats | IBigIntStats;\n * (path: PathLike,  options?: StatSyncOptions): IStats | IBigIntStats | undefined;\n * }} LStatSync\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: EncodingOption, callback: StringCallback): void;\n * (path: PathLike, options: BufferEncodingOption, callback: BufferCallback): void;\n * (path: PathLike, options: EncodingOption, callback: StringOrBufferCallback): void;\n * (path: PathLike, callback: StringCallback): void;\n * }} RealPath\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options?: EncodingOption): string;\n * (path: PathLike, options: BufferEncodingOption): Buffer;\n * (path: PathLike, options?: EncodingOption): string | Buffer;\n * }} RealPathSync\n */\n\n/**\n * @typedef {function(PathOrFileDescriptor, ReadJsonCallback): void} ReadJson\n */\n\n/**\n * @typedef {function(PathOrFileDescriptor): JsonObject} ReadJsonSync\n */\n\n/**\n * @typedef {function((string | string[] | Set<string>)=): void} Purge\n */\n\n/**\n * @typedef {Object} InputFileSystem\n * @property {ReadFile} readFile\n * @property {ReadFileSync=} readFileSync\n * @property {Readlink} readlink\n * @property {ReadlinkSync=} readlinkSync\n * @property {Readdir} readdir\n * @property {ReaddirSync=} readdirSync\n * @property {Stat} stat\n * @property {StatSync=} statSync\n * @property {LStat=} lstat\n * @property {LStatSync=} lstatSync\n * @property {RealPath=} realpath\n * @property {RealPathSync=} realpathSync\n * @property {ReadJson=} readJson\n * @property {ReadJsonSync=} readJsonSync\n * @property {Purge=} purge\n * @property {(function(string, string): string)=} join\n * @property {(function(string, string): string)=} relative\n * @property {(function(string): string)=} dirname\n */\n\n/**\n * @typedef {number | string} Mode\n */\n\n/**\n * @typedef {(ObjectEncodingOptions & import(\"events\").Abortable & { mode?: Mode | undefined, flag?: string | undefined, flush?: boolean | undefined }) | BufferEncoding | null} WriteFileOptions\n */\n\n/**\n * @typedef {{\n * (file: PathOrFileDescriptor, data: string | NodeJS.ArrayBufferView, options: WriteFileOptions, callback: NoParamCallback): void;\n * (file: PathOrFileDescriptor, data: string | NodeJS.ArrayBufferView, callback: NoParamCallback): void;\n * }} WriteFile\n */\n\n/**\n * @typedef {{ recursive?: boolean | undefined, mode?: Mode | undefined }} MakeDirectoryOptions\n */\n\n/**\n * @typedef {{\n * (file: PathLike, options: MakeDirectoryOptions & { recursive: true }, callback: StringCallback): void;\n * (file: PathLike, options: Mode | (MakeDirectoryOptions & { recursive?: false | undefined; }) | null | undefined, callback: NoParamCallback): void;\n * (file: PathLike, options: Mode | MakeDirectoryOptions | null | undefined, callback: StringCallback): void;\n * (file: PathLike, callback: NoParamCallback): void;\n * }} Mkdir\n */\n\n/**\n * @typedef {{ maxRetries?: number | undefined, recursive?: boolean | undefined, retryDelay?: number | undefined }} RmDirOptions\n */\n\n/**\n * @typedef {{\n * (file: PathLike, callback: NoParamCallback): void;\n * (file: PathLike, options: RmDirOptions, callback: NoParamCallback): void;\n * }} Rmdir\n */\n\n/**\n * @typedef {function(PathLike, NoParamCallback): void} Unlink\n */\n\n/**\n * @typedef {Object} OutputFileSystem\n * @property {WriteFile} writeFile\n * @property {Mkdir} mkdir\n * @property {Readdir=} readdir\n * @property {Rmdir=} rmdir\n * @property {Unlink=} unlink\n * @property {Stat} stat\n * @property {LStat=} lstat\n * @property {ReadFile} readFile\n * @property {(function(string, string): string)=} join\n * @property {(function(string, string): string)=} relative\n * @property {(function(string): string)=} dirname\n */\n\n/**\n * @typedef {Object} WatchFileSystem\n * @property {WatchMethod} watch\n */\n\n/**\n * @typedef {{\n * (path: PathLike, options: MakeDirectoryOptions & { recursive: true }): string | undefined;\n * (path: PathLike, options?: Mode | (MakeDirectoryOptions & { recursive?: false | undefined }) | null): void;\n * (path: PathLike, options?: Mode | MakeDirectoryOptions | null): string | undefined;\n * }} MkdirSync\n */\n\n/**\n * @typedef {Object} StreamOptions\n * @property {(string | undefined)=} flags\n * @property {(BufferEncoding | undefined)} encoding\n * @property {(number | any | undefined)=} fd\n * @property {(number | undefined)=} mode\n * @property {(boolean | undefined)=} autoClose\n * @property {(boolean | undefined)=} emitClose\n * @property {(number | undefined)=} start\n * @property {(AbortSignal | null | undefined)=} signal\n */\n\n/**\n * @typedef {Object} FSImplementation\n * @property {((...args: any[]) => any)=} open\n * @property {((...args: any[]) => any)=} close\n */\n\n/**\n * @typedef {FSImplementation & { write: (...args: any[]) => any; close?: (...args: any[]) => any }} CreateWriteStreamFSImplementation\n */\n\n/**\n * @typedef {StreamOptions & { fs?: CreateWriteStreamFSImplementation | null | undefined }} WriteStreamOptions\n */\n\n/**\n * @typedef {function(PathLike, (BufferEncoding | WriteStreamOptions)=): NodeJS.WritableStream} CreateWriteStream\n */\n\n/**\n * @typedef {number | string} OpenMode\n */\n\n/**\n * @typedef {{\n * (file: PathLike, flags: OpenMode | undefined,  mode: Mode | undefined | null, callback: NumberCallback): void;\n * (file: PathLike, flags: OpenMode | undefined, callback: NumberCallback): void;\n * (file: PathLike, callback: NumberCallback): void;\n * }} Open\n */\n\n/**\n * @typedef {number | bigint} ReadPosition\n */\n\n/**\n * @typedef {Object} ReadSyncOptions\n * @property {(number | undefined)=} offset\n * @property {(number | undefined)=} length\n * @property {(ReadPosition | null | undefined)=} position\n */\n\n/**\n * @template {NodeJS.ArrayBufferView} TBuffer\n * @typedef {Object} ReadAsyncOptions\n * @property {(number | undefined)=} offset\n * @property {(number | undefined)=} length\n * @property {(ReadPosition | null | undefined)=} position\n * @property {TBuffer=} buffer\n */\n\n/**\n * @template {NodeJS.ArrayBufferView} [TBuffer=Buffer]\n * @typedef {{\n * (fd: number, buffer: TBuffer, offset: number, length: number, position: ReadPosition | null, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: TBuffer) => void): void;\n * (fd: number, options: ReadAsyncOptions<TBuffer>, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: TBuffer) => void): void;\n * (fd: number, callback: (err: NodeJS.ErrnoException | null, bytesRead: number, buffer: NodeJS.ArrayBufferView) => void): void;\n * }} Read\n */\n\n/** @typedef {function(number, NoParamCallback): void} Close */\n\n/** @typedef {function(PathLike, PathLike, NoParamCallback): void} Rename */\n\n/**\n * @typedef {Object} IntermediateFileSystemExtras\n * @property {MkdirSync} mkdirSync\n * @property {CreateWriteStream} createWriteStream\n * @property {Open} open\n * @property {Read} read\n * @property {Close} close\n * @property {Rename} rename\n */\n\n/** @typedef {InputFileSystem & OutputFileSystem & IntermediateFileSystemExtras} IntermediateFileSystem */\n\n/**\n *\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} rootPath the root path\n * @param {string} targetPath the target path\n * @returns {string} location of targetPath relative to rootPath\n */\nconst relative = (fs, rootPath, targetPath) => {\n\tif (fs && fs.relative) {\n\t\treturn fs.relative(rootPath, targetPath);\n\t} else if (path.posix.isAbsolute(rootPath)) {\n\t\treturn path.posix.relative(rootPath, targetPath);\n\t} else if (path.win32.isAbsolute(rootPath)) {\n\t\treturn path.win32.relative(rootPath, targetPath);\n\t} else {\n\t\tthrow new Error(\n\t\t\t`${rootPath} is neither a posix nor a windows path, and there is no 'relative' method defined in the file system`\n\t\t);\n\t}\n};\nexports.relative = relative;\n\n/**\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} rootPath a path\n * @param {string} filename a filename\n * @returns {string} the joined path\n */\nconst join = (fs, rootPath, filename) => {\n\tif (fs && fs.join) {\n\t\treturn fs.join(rootPath, filename);\n\t} else if (path.posix.isAbsolute(rootPath)) {\n\t\treturn path.posix.join(rootPath, filename);\n\t} else if (path.win32.isAbsolute(rootPath)) {\n\t\treturn path.win32.join(rootPath, filename);\n\t} else {\n\t\tthrow new Error(\n\t\t\t`${rootPath} is neither a posix nor a windows path, and there is no 'join' method defined in the file system`\n\t\t);\n\t}\n};\nexports.join = join;\n\n/**\n * @param {InputFileSystem|OutputFileSystem|undefined} fs a file system\n * @param {string} absPath an absolute path\n * @returns {string} the parent directory of the absolute path\n */\nconst dirname = (fs, absPath) => {\n\tif (fs && fs.dirname) {\n\t\treturn fs.dirname(absPath);\n\t} else if (path.posix.isAbsolute(absPath)) {\n\t\treturn path.posix.dirname(absPath);\n\t} else if (path.win32.isAbsolute(absPath)) {\n\t\treturn path.win32.dirname(absPath);\n\t} else {\n\t\tthrow new Error(\n\t\t\t`${absPath} is neither a posix nor a windows path, and there is no 'dirname' method defined in the file system`\n\t\t);\n\t}\n};\nexports.dirname = dirname;\n\n/**\n * @param {OutputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {function(Error=): void} callback callback function for the error\n * @returns {void}\n */\nconst mkdirp = (fs, p, callback) => {\n\tfs.mkdir(p, err => {\n\t\tif (err) {\n\t\t\tif (err.code === \"ENOENT\") {\n\t\t\t\tconst dir = dirname(fs, p);\n\t\t\t\tif (dir === p) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tmkdirp(fs, dir, err => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tfs.mkdir(p, err => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tif (err.code === \"EEXIST\") {\n\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t} else if (err.code === \"EEXIST\") {\n\t\t\t\tcallback();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(err);\n\t\t\treturn;\n\t\t}\n\t\tcallback();\n\t});\n};\nexports.mkdirp = mkdirp;\n\n/**\n * @param {IntermediateFileSystem} fs a file system\n * @param {string} p an absolute path\n * @returns {void}\n */\nconst mkdirpSync = (fs, p) => {\n\ttry {\n\t\tfs.mkdirSync(p);\n\t} catch (err) {\n\t\tif (err) {\n\t\t\tif (/** @type {NodeJS.ErrnoException} */ (err).code === \"ENOENT\") {\n\t\t\t\tconst dir = dirname(fs, p);\n\t\t\t\tif (dir === p) {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\tmkdirpSync(fs, dir);\n\t\t\t\tfs.mkdirSync(p);\n\t\t\t\treturn;\n\t\t\t} else if (/** @type {NodeJS.ErrnoException} */ (err).code === \"EEXIST\") {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthrow err;\n\t\t}\n\t}\n};\nexports.mkdirpSync = mkdirpSync;\n\n/**\n * @param {InputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {ReadJsonCallback} callback callback\n * @returns {void}\n */\nconst readJson = (fs, p, callback) => {\n\tif (\"readJson\" in fs)\n\t\treturn /** @type {NonNullable<InputFileSystem[\"readJson\"]>} */ (\n\t\t\tfs.readJson\n\t\t)(p, callback);\n\tfs.readFile(p, (err, buf) => {\n\t\tif (err) return callback(err);\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = JSON.parse(/** @type {Buffer} */ (buf).toString(\"utf-8\"));\n\t\t} catch (e) {\n\t\t\treturn callback(/** @type {Error} */ (e));\n\t\t}\n\t\treturn callback(null, data);\n\t});\n};\nexports.readJson = readJson;\n\n/**\n * @param {InputFileSystem} fs a file system\n * @param {string} p an absolute path\n * @param {function(NodeJS.ErrnoException | Error | null, (IStats | string)=): void} callback callback\n * @returns {void}\n */\nconst lstatReadlinkAbsolute = (fs, p, callback) => {\n\tlet i = 3;\n\tconst doReadLink = () => {\n\t\tfs.readlink(p, (err, target) => {\n\t\t\tif (err && --i > 0) {\n\t\t\t\t// It might was just changed from symlink to file\n\t\t\t\t// we retry 2 times to catch this case before throwing the error\n\t\t\t\treturn doStat();\n\t\t\t}\n\t\t\tif (err || !target) return doStat();\n\t\t\tconst value = target.toString();\n\t\t\tcallback(null, join(fs, dirname(fs, p), value));\n\t\t});\n\t};\n\tconst doStat = () => {\n\t\tif (\"lstat\" in fs) {\n\t\t\treturn /** @type {NonNullable<InputFileSystem[\"lstat\"]>} */ (fs.lstat)(\n\t\t\t\tp,\n\t\t\t\t(err, stats) => {\n\t\t\t\t\tif (err) return callback(err);\n\t\t\t\t\tif (/** @type {IStats} */ (stats).isSymbolicLink()) {\n\t\t\t\t\t\treturn doReadLink();\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, stats);\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\treturn fs.stat(p, callback);\n\t\t}\n\t};\n\tif (\"lstat\" in fs) return doStat();\n\tdoReadLink();\n};\nexports.lstatReadlinkAbsolute = lstatReadlinkAbsolute;\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,YAAY;;AAEZ,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;;AAE5B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,QAAQ,GAAGA,CAACC,EAAE,EAAEC,QAAQ,EAAEC,UAAU,KAAK;EAC9C,IAAIF,EAAE,IAAIA,EAAE,CAACD,QAAQ,EAAE;IACtB,OAAOC,EAAE,CAACD,QAAQ,CAACE,QAAQ,EAAEC,UAAU,CAAC;EACzC,CAAC,MAAM,IAAIL,IAAI,CAACM,KAAK,CAACC,UAAU,CAACH,QAAQ,CAAC,EAAE;IAC3C,OAAOJ,IAAI,CAACM,KAAK,CAACJ,QAAQ,CAACE,QAAQ,EAAEC,UAAU,CAAC;EACjD,CAAC,MAAM,IAA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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}