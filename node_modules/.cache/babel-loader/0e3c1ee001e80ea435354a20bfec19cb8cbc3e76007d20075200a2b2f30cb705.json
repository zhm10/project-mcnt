{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst RuntimeModule = require(\"../RuntimeModule\");\nconst Template = require(\"../Template\");\n\n/** @typedef {import(\"../Chunk\")} Chunk */\n/** @typedef {import(\"../Chunk\").ChunkId} ChunkId */\n/** @typedef {import(\"../ChunkGraph\")} ChunkGraph */\n/** @typedef {import(\"../Compilation\")} Compilation */\n/** @typedef {import(\"./RemoteModule\")} RemoteModule */\n\nclass RemoteRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"remotes loading\");\n  }\n\n  /**\n   * @returns {string | null} runtime code\n   */\n  generate() {\n    const compilation = /** @type {Compilation} */this.compilation;\n    const chunkGraph = /** @type {ChunkGraph} */this.chunkGraph;\n    const {\n      runtimeTemplate,\n      moduleGraph\n    } = compilation;\n    /** @type {Record<ChunkId, (string | number)[]>} */\n    const chunkToRemotesMapping = {};\n    /** @type {Record<string | number, [string, string, string | number | null]>} */\n    const idToExternalAndNameMapping = {};\n    for (const chunk of /** @type {Chunk} */this.chunk.getAllAsyncChunks()) {\n      const modules = chunkGraph.getChunkModulesIterableBySourceType(chunk, \"remote\");\n      if (!modules) continue;\n      /** @type {(string | number)[]} */\n      const remotes = chunkToRemotesMapping[( /** @type {ChunkId} */chunk.id)] = [];\n      for (const m of modules) {\n        const module = /** @type {RemoteModule} */m;\n        const name = module.internalRequest;\n        const id = chunkGraph.getModuleId(module);\n        const shareScope = module.shareScope;\n        const dep = module.dependencies[0];\n        const externalModule = moduleGraph.getModule(dep);\n        const externalModuleId = externalModule && chunkGraph.getModuleId(externalModule);\n        remotes.push(id);\n        idToExternalAndNameMapping[id] = [shareScope, name, externalModuleId];\n      }\n    }\n    return Template.asString([`var chunkMapping = ${JSON.stringify(chunkToRemotesMapping, null, \"\\t\")};`, `var idToExternalAndNameMapping = ${JSON.stringify(idToExternalAndNameMapping, null, \"\\t\")};`, `${RuntimeGlobals.ensureChunkHandlers}.remotes = ${runtimeTemplate.basicFunction(\"chunkId, promises\", [`if(${RuntimeGlobals.hasOwnProperty}(chunkMapping, chunkId)) {`, Template.indent([`chunkMapping[chunkId].forEach(${runtimeTemplate.basicFunction(\"id\", [`var getScope = ${RuntimeGlobals.currentRemoteGetScope};`, \"if(!getScope) getScope = [];\", \"var data = idToExternalAndNameMapping[id];\", \"if(getScope.indexOf(data) >= 0) return;\", \"getScope.push(data);\", `if(data.p) return promises.push(data.p);`, `var onError = ${runtimeTemplate.basicFunction(\"error\", ['if(!error) error = new Error(\"Container missing\");', 'if(typeof error.message === \"string\")', Template.indent(`error.message += '\\\\nwhile loading \"' + data[1] + '\" from ' + data[2];`), `${RuntimeGlobals.moduleFactories}[id] = ${runtimeTemplate.basicFunction(\"\", [\"throw error;\"])}`, \"data.p = 0;\"])};`, `var handleFunction = ${runtimeTemplate.basicFunction(\"fn, arg1, arg2, d, next, first\", [\"try {\", Template.indent([\"var promise = fn(arg1, arg2);\", \"if(promise && promise.then) {\", Template.indent([`var p = promise.then(${runtimeTemplate.returningFunction(\"next(result, d)\", \"result\")}, onError);`, `if(first) promises.push(data.p = p); else return p;`]), \"} else {\", Template.indent([\"return next(promise, d, first);\"]), \"}\"]), \"} catch(error) {\", Template.indent([\"onError(error);\"]), \"}\"])}`, `var onExternal = ${runtimeTemplate.returningFunction(`external ? handleFunction(${RuntimeGlobals.initializeSharing}, data[0], 0, external, onInitialized, first) : onError()`, \"external, _, first\")};`, `var onInitialized = ${runtimeTemplate.returningFunction(`handleFunction(external.get, data[1], getScope, 0, onFactory, first)`, \"_, external, first\")};`, `var onFactory = ${runtimeTemplate.basicFunction(\"factory\", [\"data.p = 1;\", `${RuntimeGlobals.moduleFactories}[id] = ${runtimeTemplate.basicFunction(\"module\", [\"module.exports = factory();\"])}`])};`, `handleFunction(${RuntimeGlobals.require}, data[2], 0, 0, onExternal, 1);`])});`]), \"}\"])}`]);\n  }\n}\nmodule.exports = RemoteRuntimeModule;","map":{"version":3,"names":["RuntimeGlobals","require","RuntimeModule","Template","RemoteRuntimeModule","constructor","generate","compilation","chunkGraph","runtimeTemplate","moduleGraph","chunkToRemotesMapping","idToExternalAndNameMapping","chunk","getAllAsyncChunks","modules","getChunkModulesIterableBySourceType","remotes","id","m","module","name","internalRequest","getModuleId","shareScope","dep","dependencies","externalModule","getModule","externalModuleId","push","asString","JSON","stringify","ensureChunkHandlers","basicFunction","hasOwnProperty","indent","currentRemoteGetScope","moduleFactories","returningFunction","initializeSharing","exports"],"sources":["/Volumes/storage/projects/project-mcnt/node_modules/webpack/lib/container/RemoteRuntimeModule.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst RuntimeModule = require(\"../RuntimeModule\");\nconst Template = require(\"../Template\");\n\n/** @typedef {import(\"../Chunk\")} Chunk */\n/** @typedef {import(\"../Chunk\").ChunkId} ChunkId */\n/** @typedef {import(\"../ChunkGraph\")} ChunkGraph */\n/** @typedef {import(\"../Compilation\")} Compilation */\n/** @typedef {import(\"./RemoteModule\")} RemoteModule */\n\nclass RemoteRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"remotes loading\");\n\t}\n\n\t/**\n\t * @returns {string | null} runtime code\n\t */\n\tgenerate() {\n\t\tconst compilation = /** @type {Compilation} */ (this.compilation);\n\t\tconst chunkGraph = /** @type {ChunkGraph} */ (this.chunkGraph);\n\t\tconst { runtimeTemplate, moduleGraph } = compilation;\n\t\t/** @type {Record<ChunkId, (string | number)[]>} */\n\t\tconst chunkToRemotesMapping = {};\n\t\t/** @type {Record<string | number, [string, string, string | number | null]>} */\n\t\tconst idToExternalAndNameMapping = {};\n\t\tfor (const chunk of /** @type {Chunk} */ (this.chunk).getAllAsyncChunks()) {\n\t\t\tconst modules = chunkGraph.getChunkModulesIterableBySourceType(\n\t\t\t\tchunk,\n\t\t\t\t\"remote\"\n\t\t\t);\n\t\t\tif (!modules) continue;\n\t\t\t/** @type {(string | number)[]} */\n\t\t\tconst remotes = (chunkToRemotesMapping[\n\t\t\t\t/** @type {ChunkId} */ (chunk.id)\n\t\t\t] = []);\n\t\t\tfor (const m of modules) {\n\t\t\t\tconst module = /** @type {RemoteModule} */ (m);\n\t\t\t\tconst name = module.internalRequest;\n\t\t\t\tconst id = chunkGraph.getModuleId(module);\n\t\t\t\tconst shareScope = module.shareScope;\n\t\t\t\tconst dep = module.dependencies[0];\n\t\t\t\tconst externalModule = moduleGraph.getModule(dep);\n\t\t\t\tconst externalModuleId =\n\t\t\t\t\texternalModule && chunkGraph.getModuleId(externalModule);\n\t\t\t\tremotes.push(id);\n\t\t\t\tidToExternalAndNameMapping[id] = [shareScope, name, externalModuleId];\n\t\t\t}\n\t\t}\n\t\treturn Template.asString([\n\t\t\t`var chunkMapping = ${JSON.stringify(\n\t\t\t\tchunkToRemotesMapping,\n\t\t\t\tnull,\n\t\t\t\t\"\\t\"\n\t\t\t)};`,\n\t\t\t`var idToExternalAndNameMapping = ${JSON.stringify(\n\t\t\t\tidToExternalAndNameMapping,\n\t\t\t\tnull,\n\t\t\t\t\"\\t\"\n\t\t\t)};`,\n\t\t\t`${\n\t\t\t\tRuntimeGlobals.ensureChunkHandlers\n\t\t\t}.remotes = ${runtimeTemplate.basicFunction(\"chunkId, promises\", [\n\t\t\t\t`if(${RuntimeGlobals.hasOwnProperty}(chunkMapping, chunkId)) {`,\n\t\t\t\tTemplate.indent([\n\t\t\t\t\t`chunkMapping[chunkId].forEach(${runtimeTemplate.basicFunction(\"id\", [\n\t\t\t\t\t\t`var getScope = ${RuntimeGlobals.currentRemoteGetScope};`,\n\t\t\t\t\t\t\"if(!getScope) getScope = [];\",\n\t\t\t\t\t\t\"var data = idToExternalAndNameMapping[id];\",\n\t\t\t\t\t\t\"if(getScope.indexOf(data) >= 0) return;\",\n\t\t\t\t\t\t\"getScope.push(data);\",\n\t\t\t\t\t\t`if(data.p) return promises.push(data.p);`,\n\t\t\t\t\t\t`var onError = ${runtimeTemplate.basicFunction(\"error\", [\n\t\t\t\t\t\t\t'if(!error) error = new Error(\"Container missing\");',\n\t\t\t\t\t\t\t'if(typeof error.message === \"string\")',\n\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t`error.message += '\\\\nwhile loading \"' + data[1] + '\" from ' + data[2];`\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t`${\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleFactories\n\t\t\t\t\t\t\t}[id] = ${runtimeTemplate.basicFunction(\"\", [\"throw error;\"])}`,\n\t\t\t\t\t\t\t\"data.p = 0;\"\n\t\t\t\t\t\t])};`,\n\t\t\t\t\t\t`var handleFunction = ${runtimeTemplate.basicFunction(\n\t\t\t\t\t\t\t\"fn, arg1, arg2, d, next, first\",\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\"try {\",\n\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\"var promise = fn(arg1, arg2);\",\n\t\t\t\t\t\t\t\t\t\"if(promise && promise.then) {\",\n\t\t\t\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\t\t\t`var p = promise.then(${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t\t\t\t\t\"next(result, d)\",\n\t\t\t\t\t\t\t\t\t\t\t\"result\"\n\t\t\t\t\t\t\t\t\t\t)}, onError);`,\n\t\t\t\t\t\t\t\t\t\t`if(first) promises.push(data.p = p); else return p;`\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\"} else {\",\n\t\t\t\t\t\t\t\t\tTemplate.indent([\"return next(promise, d, first);\"]),\n\t\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\"} catch(error) {\",\n\t\t\t\t\t\t\t\tTemplate.indent([\"onError(error);\"]),\n\t\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t`var onExternal = ${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t`external ? handleFunction(${RuntimeGlobals.initializeSharing}, data[0], 0, external, onInitialized, first) : onError()`,\n\t\t\t\t\t\t\t\"external, _, first\"\n\t\t\t\t\t\t)};`,\n\t\t\t\t\t\t`var onInitialized = ${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t`handleFunction(external.get, data[1], getScope, 0, onFactory, first)`,\n\t\t\t\t\t\t\t\"_, external, first\"\n\t\t\t\t\t\t)};`,\n\t\t\t\t\t\t`var onFactory = ${runtimeTemplate.basicFunction(\"factory\", [\n\t\t\t\t\t\t\t\"data.p = 1;\",\n\t\t\t\t\t\t\t`${\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleFactories\n\t\t\t\t\t\t\t}[id] = ${runtimeTemplate.basicFunction(\"module\", [\n\t\t\t\t\t\t\t\t\"module.exports = factory();\"\n\t\t\t\t\t\t\t])}`\n\t\t\t\t\t\t])};`,\n\t\t\t\t\t\t`handleFunction(${RuntimeGlobals.require}, data[2], 0, 0, onExternal, 1);`\n\t\t\t\t\t])});`\n\t\t\t\t]),\n\t\t\t\t\"}\"\n\t\t\t])}`\n\t\t]);\n\t}\n}\n\nmodule.exports = RemoteRuntimeModule;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}