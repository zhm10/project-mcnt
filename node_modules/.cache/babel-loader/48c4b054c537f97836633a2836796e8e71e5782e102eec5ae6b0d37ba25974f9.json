{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst CachedInputFileSystem = require(\"enhanced-resolve\").CachedInputFileSystem;\nconst fs = require(\"graceful-fs\");\nconst createConsoleLogger = require(\"../logging/createConsoleLogger\");\nconst NodeWatchFileSystem = require(\"./NodeWatchFileSystem\");\nconst nodeConsole = require(\"./nodeConsole\");\n\n/** @typedef {import(\"../../declarations/WebpackOptions\").InfrastructureLogging} InfrastructureLogging */\n/** @typedef {import(\"../Compiler\")} Compiler */\n/** @typedef {import(\"../util/fs\").InputFileSystem} InputFileSystem */\n\nclass NodeEnvironmentPlugin {\n  /**\n   * @param {Object} options options\n   * @param {InfrastructureLogging} options.infrastructureLogging infrastructure logging options\n   */\n  constructor(options) {\n    this.options = options;\n  }\n\n  /**\n   * Apply the plugin\n   * @param {Compiler} compiler the compiler instance\n   * @returns {void}\n   */\n  apply(compiler) {\n    const {\n      infrastructureLogging\n    } = this.options;\n    compiler.infrastructureLogger = createConsoleLogger({\n      level: infrastructureLogging.level || \"info\",\n      debug: infrastructureLogging.debug || false,\n      console: infrastructureLogging.console || nodeConsole({\n        colors: infrastructureLogging.colors,\n        appendOnly: infrastructureLogging.appendOnly,\n        stream: ( /** @type {NodeJS.WritableStream} */\n        infrastructureLogging.stream)\n      })\n    });\n    compiler.inputFileSystem = new CachedInputFileSystem(fs, 60000);\n    const inputFileSystem = /** @type {InputFileSystem} */\n    compiler.inputFileSystem;\n    compiler.outputFileSystem = fs;\n    compiler.intermediateFileSystem = fs;\n    compiler.watchFileSystem = new NodeWatchFileSystem(inputFileSystem);\n    compiler.hooks.beforeRun.tap(\"NodeEnvironmentPlugin\", compiler => {\n      if (compiler.inputFileSystem === inputFileSystem && inputFileSystem.purge) {\n        compiler.fsStartTime = Date.now();\n        inputFileSystem.purge();\n      }\n    });\n  }\n}\nmodule.exports = NodeEnvironmentPlugin;","map":{"version":3,"names":["CachedInputFileSystem","require","fs","createConsoleLogger","NodeWatchFileSystem","nodeConsole","NodeEnvironmentPlugin","constructor","options","apply","compiler","infrastructureLogging","infrastructureLogger","level","debug","console","colors","appendOnly","stream","inputFileSystem","outputFileSystem","intermediateFileSystem","watchFileSystem","hooks","beforeRun","tap","purge","fsStartTime","Date","now","module","exports"],"sources":["/Volumes/storage/projects/project-mcnt/node_modules/webpack/lib/node/NodeEnvironmentPlugin.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst CachedInputFileSystem = require(\"enhanced-resolve\").CachedInputFileSystem;\nconst fs = require(\"graceful-fs\");\nconst createConsoleLogger = require(\"../logging/createConsoleLogger\");\nconst NodeWatchFileSystem = require(\"./NodeWatchFileSystem\");\nconst nodeConsole = require(\"./nodeConsole\");\n\n/** @typedef {import(\"../../declarations/WebpackOptions\").InfrastructureLogging} InfrastructureLogging */\n/** @typedef {import(\"../Compiler\")} Compiler */\n/** @typedef {import(\"../util/fs\").InputFileSystem} InputFileSystem */\n\nclass NodeEnvironmentPlugin {\n\t/**\n\t * @param {Object} options options\n\t * @param {InfrastructureLogging} options.infrastructureLogging infrastructure logging options\n\t */\n\tconstructor(options) {\n\t\tthis.options = options;\n\t}\n\n\t/**\n\t * Apply the plugin\n\t * @param {Compiler} compiler the compiler instance\n\t * @returns {void}\n\t */\n\tapply(compiler) {\n\t\tconst { infrastructureLogging } = this.options;\n\t\tcompiler.infrastructureLogger = createConsoleLogger({\n\t\t\tlevel: infrastructureLogging.level || \"info\",\n\t\t\tdebug: infrastructureLogging.debug || false,\n\t\t\tconsole:\n\t\t\t\tinfrastructureLogging.console ||\n\t\t\t\tnodeConsole({\n\t\t\t\t\tcolors: infrastructureLogging.colors,\n\t\t\t\t\tappendOnly: infrastructureLogging.appendOnly,\n\t\t\t\t\tstream:\n\t\t\t\t\t\t/** @type {NodeJS.WritableStream} */\n\t\t\t\t\t\t(infrastructureLogging.stream)\n\t\t\t\t})\n\t\t});\n\t\tcompiler.inputFileSystem = new CachedInputFileSystem(fs, 60000);\n\t\tconst inputFileSystem =\n\t\t\t/** @type {InputFileSystem} */\n\t\t\t(compiler.inputFileSystem);\n\t\tcompiler.outputFileSystem = fs;\n\t\tcompiler.intermediateFileSystem = fs;\n\t\tcompiler.watchFileSystem = new NodeWatchFileSystem(inputFileSystem);\n\t\tcompiler.hooks.beforeRun.tap(\"NodeEnvironmentPlugin\", compiler => {\n\t\t\tif (\n\t\t\t\tcompiler.inputFileSystem === inputFileSystem &&\n\t\t\t\tinputFileSystem.purge\n\t\t\t) {\n\t\t\t\tcompiler.fsStartTime = Date.now();\n\t\t\t\tinputFileSystem.purge();\n\t\t\t}\n\t\t});\n\t}\n}\n\nmodule.exports = NodeEnvironmentPlugin;\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,YAAY;;AAEZ,MAAMA,qBAAqB,GAAGC,OAAO,CAAC,kBAAkB,CAAC,CAACD,qBAAqB;AAC/E,MAAME,EAAE,GAAGD,OAAO,CAAC,aAAa,CAAC;AACjC,MAAME,mBAAmB,GAAGF,OAAO,CAAC,gCAAgC,CAAC;AACrE,MAAMG,mBAAmB,GAAGH,OAAO,CAAC,uBAAuB,CAAC;AAC5D,MAAMI,WAAW,GAAGJ,OAAO,CAAC,eAAe,CAAC;;AAE5C;AACA;AACA;;AAEA,MAAMK,qBAAqB,CAAC;EAC3B;AACD;AACA;AACA;EACCC,WAAWA,CAACC,OAAO,EAAE;IACpB,IAAI,CAACA,OAAO,GAAGA,OAAO;EACvB;;EAEA;AACD;AACA;AACA;AACA;EACCC,KAAKA,CAACC,QAAQ,EAAE;IACf,MAAM;MAAEC;IAAsB,CAAC,GAAG,IAAI,CAACH,OAAO;IAC9CE,QAAQ,CAACE,oBAAoB,GAAGT,mBAAmB,CAAC;MACnDU,KAAK,EAAEF,qBAAqB,CAACE,KAAK,IAAI,MAAM;MAC5CC,KAAK,EAAEH,qBAAqB,CAACG,KAAK,IAAI,KAAK;MAC3CC,OAAO,EACNJ,qBAAqB,CAACI,OAAO,IAC7BV,WAAW,CAAC;QACXW,MAAM,EAAEL,qBAAqB,CAACK,MAAM;QACpCC,UAAU,EAAEN,qBAAqB,CAACM,UAAU;QAC5CC,MAAM,IACL;QACCP,qBAAqB,CAACO,MAAM;MAC/B,CAAC;IACH,CAAC,CAAC;IACFR,QAAQ,CAACS,eAAe,GAAG,IAAInB,qBAAqB,CAACE,EAAE,EAAE,KAAK,CAAC;IAC/D,MAAMiB,eAAe,GACpB;IACCT,QAAQ,CAACS,eAAgB;IAC3BT,QAAQ,CAACU,gBAAgB,GAAGlB,EAAE;IAC9BQ,QAAQ,CAACW,sBAAsB,GAAGnB,EAAE;IACpCQ,QAAQ,CAACY,eAAe,GAAG,IAAIlB,mBAAmB,CAACe,eAAe,CAAC;IACnET,QAAQ,CAACa,KAAK,CAACC,SAAS,CAACC,GAAG,CAAC,uBAAuB,EAAEf,QAAQ,IAAI;MACjE,IACCA,QAAQ,CAACS,eAAe,KAAKA,eAAe,IAC5CA,eAAe,CAACO,KAAK,EACpB;QACDhB,QAAQ,CAACiB,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;QACjCV,eAAe,CAACO,KAAK,CAAC,CAAC;MACxB;IACD,CAAC,CAAC;EACH;AACD;AAEAI,MAAM,CAACC,OAAO,GAAGzB,qBAAqB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}