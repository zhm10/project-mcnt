{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Sergey Melyukov @smelukov\n*/\n\n\"use strict\";\n\nconst {\n  ReplaceSource,\n  RawSource,\n  ConcatSource\n} = require(\"webpack-sources\");\nconst {\n  UsageState\n} = require(\"../ExportsInfo\");\nconst Generator = require(\"../Generator\");\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst Template = require(\"../Template\");\nconst {\n  cssExportConvention\n} = require(\"../util/conventions\");\n\n/** @typedef {import(\"webpack-sources\").Source} Source */\n/** @typedef {import(\"../../declarations/WebpackOptions\").CssGeneratorExportsConvention} CssGeneratorExportsConvention */\n/** @typedef {import(\"../../declarations/WebpackOptions\").CssGeneratorLocalIdentName} CssGeneratorLocalIdentName */\n/** @typedef {import(\"../Dependency\")} Dependency */\n/** @typedef {import(\"../Generator\").GenerateContext} GenerateContext */\n/** @typedef {import(\"../Generator\").UpdateHashContext} UpdateHashContext */\n/** @typedef {import(\"../Module\").ConcatenationBailoutReasonContext} ConcatenationBailoutReasonContext */\n/** @typedef {import(\"../NormalModule\")} NormalModule */\n/** @typedef {import(\"../util/Hash\")} Hash */\n\n/**\n * @template T\n * @typedef {import(\"../InitFragment\")<T>} InitFragment\n */\n\nconst TYPES = new Set([\"javascript\"]);\nclass CssExportsGenerator extends Generator {\n  /**\n   * @param {CssGeneratorExportsConvention} convention the convention of the exports name\n   * @param {CssGeneratorLocalIdentName | undefined} localIdentName css export local ident name\n   */\n  constructor(convention, localIdentName) {\n    super();\n    /** @type {CssGeneratorExportsConvention} */\n    this.convention = convention;\n    /** @type {CssGeneratorLocalIdentName | undefined} */\n    this.localIdentName = localIdentName;\n  }\n\n  // TODO add getConcatenationBailoutReason to allow concatenation\n  // but how to make it have a module id\n\n  /**\n   * @param {NormalModule} module module for which the code should be generated\n   * @param {GenerateContext} generateContext context for generate\n   * @returns {Source} generated code\n   */\n  generate(module, generateContext) {\n    const source = new ReplaceSource(new RawSource(\"\"));\n    /** @type {InitFragment<TODO>[]} */\n    const initFragments = [];\n    /** @type {Map<string, string>} */\n    const cssExports = new Map();\n    generateContext.runtimeRequirements.add(RuntimeGlobals.module);\n    let chunkInitFragments;\n    const runtimeRequirements = new Set();\n    const templateContext = {\n      runtimeTemplate: generateContext.runtimeTemplate,\n      dependencyTemplates: generateContext.dependencyTemplates,\n      moduleGraph: generateContext.moduleGraph,\n      chunkGraph: generateContext.chunkGraph,\n      module,\n      runtime: generateContext.runtime,\n      runtimeRequirements: runtimeRequirements,\n      concatenationScope: generateContext.concatenationScope,\n      codeGenerationResults: generateContext.codeGenerationResults,\n      initFragments,\n      cssExports,\n      get chunkInitFragments() {\n        if (!chunkInitFragments) {\n          const data = generateContext.getData();\n          chunkInitFragments = data.get(\"chunkInitFragments\");\n          if (!chunkInitFragments) {\n            chunkInitFragments = [];\n            data.set(\"chunkInitFragments\", chunkInitFragments);\n          }\n        }\n        return chunkInitFragments;\n      }\n    };\n\n    /**\n     * @param {Dependency} dependency the dependency\n     */\n    const handleDependency = dependency => {\n      const constructor = /** @type {new (...args: any[]) => Dependency} */\n      dependency.constructor;\n      const template = generateContext.dependencyTemplates.get(constructor);\n      if (!template) {\n        throw new Error(\"No template for dependency: \" + dependency.constructor.name);\n      }\n      template.apply(dependency, source, templateContext);\n    };\n    module.dependencies.forEach(handleDependency);\n    if (generateContext.concatenationScope) {\n      const source = new ConcatSource();\n      const usedIdentifiers = new Set();\n      for (const [name, v] of cssExports) {\n        for (let k of cssExportConvention(name, this.convention)) {\n          let identifier = Template.toIdentifier(k);\n          let i = 0;\n          while (usedIdentifiers.has(identifier)) {\n            identifier = Template.toIdentifier(k + i);\n          }\n          usedIdentifiers.add(identifier);\n          generateContext.concatenationScope.registerExport(k, identifier);\n          source.add(`${generateContext.runtimeTemplate.supportsConst() ? \"const\" : \"var\"} ${identifier} = ${JSON.stringify(v)};\\n`);\n        }\n      }\n      return source;\n    } else {\n      const otherUsed = generateContext.moduleGraph.getExportsInfo(module).otherExportsInfo.getUsed(generateContext.runtime) !== UsageState.Unused;\n      if (otherUsed) {\n        generateContext.runtimeRequirements.add(RuntimeGlobals.makeNamespaceObject);\n      }\n      const newCssExports = [];\n      for (let [k, v] of cssExports) {\n        for (let name of cssExportConvention(k, this.convention)) {\n          newCssExports.push(`\\t${JSON.stringify(name)}: ${JSON.stringify(v)}`);\n        }\n      }\n      return new RawSource(`${otherUsed ? `${RuntimeGlobals.makeNamespaceObject}(` : \"\"}${module.moduleArgument}.exports = {\\n${newCssExports.join(\",\\n\")}\\n}${otherUsed ? \")\" : \"\"};`);\n    }\n  }\n\n  /**\n   * @param {NormalModule} module fresh module\n   * @returns {Set<string>} available types (do not mutate)\n   */\n  getTypes(module) {\n    return TYPES;\n  }\n\n  /**\n   * @param {NormalModule} module the module\n   * @param {string=} type source type\n   * @returns {number} estimate size of the module\n   */\n  getSize(module, type) {\n    return 42;\n  }\n\n  /**\n   * @param {Hash} hash hash that will be modified\n   * @param {UpdateHashContext} updateHashContext context for updating hash\n   */\n  updateHash(hash, {\n    module\n  }) {}\n}\nmodule.exports = CssExportsGenerator;","map":{"version":3,"names":["ReplaceSource","RawSource","ConcatSource","require","UsageState","Generator","RuntimeGlobals","Template","cssExportConvention","TYPES","Set","CssExportsGenerator","constructor","convention","localIdentName","generate","module","generateContext","source","initFragments","cssExports","Map","runtimeRequirements","add","chunkInitFragments","templateContext","runtimeTemplate","dependencyTemplates","moduleGraph","chunkGraph","runtime","concatenationScope","codeGenerationResults","data","getData","get","set","handleDependency","dependency","template","Error","name","apply","dependencies","forEach","usedIdentifiers","v","k","identifier","toIdentifier","i","has","registerExport","supportsConst","JSON","stringify","otherUsed","getExportsInfo","otherExportsInfo","getUsed","Unused","makeNamespaceObject","newCssExports","push","moduleArgument","join","getTypes","getSize","type","updateHash","hash","exports"],"sources":["/Volumes/storage/projects/project-mcnt/node_modules/webpack/lib/css/CssExportsGenerator.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Sergey Melyukov @smelukov\n*/\n\n\"use strict\";\n\nconst { ReplaceSource, RawSource, ConcatSource } = require(\"webpack-sources\");\nconst { UsageState } = require(\"../ExportsInfo\");\nconst Generator = require(\"../Generator\");\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst Template = require(\"../Template\");\nconst { cssExportConvention } = require(\"../util/conventions\");\n\n/** @typedef {import(\"webpack-sources\").Source} Source */\n/** @typedef {import(\"../../declarations/WebpackOptions\").CssGeneratorExportsConvention} CssGeneratorExportsConvention */\n/** @typedef {import(\"../../declarations/WebpackOptions\").CssGeneratorLocalIdentName} CssGeneratorLocalIdentName */\n/** @typedef {import(\"../Dependency\")} Dependency */\n/** @typedef {import(\"../Generator\").GenerateContext} GenerateContext */\n/** @typedef {import(\"../Generator\").UpdateHashContext} UpdateHashContext */\n/** @typedef {import(\"../Module\").ConcatenationBailoutReasonContext} ConcatenationBailoutReasonContext */\n/** @typedef {import(\"../NormalModule\")} NormalModule */\n/** @typedef {import(\"../util/Hash\")} Hash */\n\n/**\n * @template T\n * @typedef {import(\"../InitFragment\")<T>} InitFragment\n */\n\nconst TYPES = new Set([\"javascript\"]);\n\nclass CssExportsGenerator extends Generator {\n\t/**\n\t * @param {CssGeneratorExportsConvention} convention the convention of the exports name\n\t * @param {CssGeneratorLocalIdentName | undefined} localIdentName css export local ident name\n\t */\n\tconstructor(convention, localIdentName) {\n\t\tsuper();\n\t\t/** @type {CssGeneratorExportsConvention} */\n\t\tthis.convention = convention;\n\t\t/** @type {CssGeneratorLocalIdentName | undefined} */\n\t\tthis.localIdentName = localIdentName;\n\t}\n\n\t// TODO add getConcatenationBailoutReason to allow concatenation\n\t// but how to make it have a module id\n\n\t/**\n\t * @param {NormalModule} module module for which the code should be generated\n\t * @param {GenerateContext} generateContext context for generate\n\t * @returns {Source} generated code\n\t */\n\tgenerate(module, generateContext) {\n\t\tconst source = new ReplaceSource(new RawSource(\"\"));\n\t\t/** @type {InitFragment<TODO>[]} */\n\t\tconst initFragments = [];\n\t\t/** @type {Map<string, string>} */\n\t\tconst cssExports = new Map();\n\n\t\tgenerateContext.runtimeRequirements.add(RuntimeGlobals.module);\n\n\t\tlet chunkInitFragments;\n\t\tconst runtimeRequirements = new Set();\n\n\t\tconst templateContext = {\n\t\t\truntimeTemplate: generateContext.runtimeTemplate,\n\t\t\tdependencyTemplates: generateContext.dependencyTemplates,\n\t\t\tmoduleGraph: generateContext.moduleGraph,\n\t\t\tchunkGraph: generateContext.chunkGraph,\n\t\t\tmodule,\n\t\t\truntime: generateContext.runtime,\n\t\t\truntimeRequirements: runtimeRequirements,\n\t\t\tconcatenationScope: generateContext.concatenationScope,\n\t\t\tcodeGenerationResults: generateContext.codeGenerationResults,\n\t\t\tinitFragments,\n\t\t\tcssExports,\n\t\t\tget chunkInitFragments() {\n\t\t\t\tif (!chunkInitFragments) {\n\t\t\t\t\tconst data = generateContext.getData();\n\t\t\t\t\tchunkInitFragments = data.get(\"chunkInitFragments\");\n\t\t\t\t\tif (!chunkInitFragments) {\n\t\t\t\t\t\tchunkInitFragments = [];\n\t\t\t\t\t\tdata.set(\"chunkInitFragments\", chunkInitFragments);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn chunkInitFragments;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {Dependency} dependency the dependency\n\t\t */\n\t\tconst handleDependency = dependency => {\n\t\t\tconst constructor = /** @type {new (...args: any[]) => Dependency} */ (\n\t\t\t\tdependency.constructor\n\t\t\t);\n\t\t\tconst template = generateContext.dependencyTemplates.get(constructor);\n\t\t\tif (!template) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"No template for dependency: \" + dependency.constructor.name\n\t\t\t\t);\n\t\t\t}\n\n\t\t\ttemplate.apply(dependency, source, templateContext);\n\t\t};\n\t\tmodule.dependencies.forEach(handleDependency);\n\n\t\tif (generateContext.concatenationScope) {\n\t\t\tconst source = new ConcatSource();\n\t\t\tconst usedIdentifiers = new Set();\n\t\t\tfor (const [name, v] of cssExports) {\n\t\t\t\tfor (let k of cssExportConvention(name, this.convention)) {\n\t\t\t\t\tlet identifier = Template.toIdentifier(k);\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\twhile (usedIdentifiers.has(identifier)) {\n\t\t\t\t\t\tidentifier = Template.toIdentifier(k + i);\n\t\t\t\t\t}\n\t\t\t\t\tusedIdentifiers.add(identifier);\n\t\t\t\t\tgenerateContext.concatenationScope.registerExport(k, identifier);\n\t\t\t\t\tsource.add(\n\t\t\t\t\t\t`${\n\t\t\t\t\t\t\tgenerateContext.runtimeTemplate.supportsConst() ? \"const\" : \"var\"\n\t\t\t\t\t\t} ${identifier} = ${JSON.stringify(v)};\\n`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn source;\n\t\t} else {\n\t\t\tconst otherUsed =\n\t\t\t\tgenerateContext.moduleGraph\n\t\t\t\t\t.getExportsInfo(module)\n\t\t\t\t\t.otherExportsInfo.getUsed(generateContext.runtime) !==\n\t\t\t\tUsageState.Unused;\n\t\t\tif (otherUsed) {\n\t\t\t\tgenerateContext.runtimeRequirements.add(\n\t\t\t\t\tRuntimeGlobals.makeNamespaceObject\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst newCssExports = [];\n\t\t\tfor (let [k, v] of cssExports) {\n\t\t\t\tfor (let name of cssExportConvention(k, this.convention)) {\n\t\t\t\t\tnewCssExports.push(`\\t${JSON.stringify(name)}: ${JSON.stringify(v)}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn new RawSource(\n\t\t\t\t`${otherUsed ? `${RuntimeGlobals.makeNamespaceObject}(` : \"\"}${\n\t\t\t\t\tmodule.moduleArgument\n\t\t\t\t}.exports = {\\n${newCssExports.join(\",\\n\")}\\n}${otherUsed ? \")\" : \"\"};`\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * @param {NormalModule} module fresh module\n\t * @returns {Set<string>} available types (do not mutate)\n\t */\n\tgetTypes(module) {\n\t\treturn TYPES;\n\t}\n\n\t/**\n\t * @param {NormalModule} module the module\n\t * @param {string=} type source type\n\t * @returns {number} estimate size of the module\n\t */\n\tgetSize(module, type) {\n\t\treturn 42;\n\t}\n\n\t/**\n\t * @param {Hash} hash hash that will be modified\n\t * @param {UpdateHashContext} updateHashContext context for updating hash\n\t */\n\tupdateHash(hash, { module }) {}\n}\n\nmodule.exports = CssExportsGenerator;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}