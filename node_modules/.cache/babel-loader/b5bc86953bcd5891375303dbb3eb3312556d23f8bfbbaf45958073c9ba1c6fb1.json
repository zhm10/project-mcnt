{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n*/\n\n\"use strict\";\n\nconst {\n  SyncWaterfallHook\n} = require(\"tapable\");\nconst Compilation = require(\"../Compilation\");\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst Template = require(\"../Template\");\nconst HelperRuntimeModule = require(\"./HelperRuntimeModule\");\n\n/** @typedef {import(\"../Chunk\")} Chunk */\n/** @typedef {import(\"../Compiler\")} Compiler */\n\n/**\n * @typedef {Object} LoadScriptCompilationHooks\n * @property {SyncWaterfallHook<[string, Chunk]>} createScript\n */\n\n/** @type {WeakMap<Compilation, LoadScriptCompilationHooks>} */\nconst compilationHooksMap = new WeakMap();\nclass LoadScriptRuntimeModule extends HelperRuntimeModule {\n  /**\n   * @param {Compilation} compilation the compilation\n   * @returns {LoadScriptCompilationHooks} hooks\n   */\n  static getCompilationHooks(compilation) {\n    if (!(compilation instanceof Compilation)) {\n      throw new TypeError(\"The 'compilation' argument must be an instance of Compilation\");\n    }\n    let hooks = compilationHooksMap.get(compilation);\n    if (hooks === undefined) {\n      hooks = {\n        createScript: new SyncWaterfallHook([\"source\", \"chunk\"])\n      };\n      compilationHooksMap.set(compilation, hooks);\n    }\n    return hooks;\n  }\n\n  /**\n   * @param {boolean=} withCreateScriptUrl use create script url for trusted types\n   * @param {boolean=} withFetchPriority use `fetchPriority` attribute\n   */\n  constructor(withCreateScriptUrl, withFetchPriority) {\n    super(\"load script\");\n    this._withCreateScriptUrl = withCreateScriptUrl;\n    this._withFetchPriority = withFetchPriority;\n  }\n\n  /**\n   * @returns {string | null} runtime code\n   */\n  generate() {\n    const compilation = /** @type {Compilation} */this.compilation;\n    const {\n      runtimeTemplate,\n      outputOptions\n    } = compilation;\n    const {\n      scriptType,\n      chunkLoadTimeout: loadTimeout,\n      crossOriginLoading,\n      uniqueName,\n      charset\n    } = outputOptions;\n    const fn = RuntimeGlobals.loadScript;\n    const {\n      createScript\n    } = LoadScriptRuntimeModule.getCompilationHooks(compilation);\n    const code = Template.asString([\"script = document.createElement('script');\", scriptType ? `script.type = ${JSON.stringify(scriptType)};` : \"\", charset ? \"script.charset = 'utf-8';\" : \"\", `script.timeout = ${/** @type {number} */loadTimeout / 1000};`, `if (${RuntimeGlobals.scriptNonce}) {`, Template.indent(`script.setAttribute(\"nonce\", ${RuntimeGlobals.scriptNonce});`), \"}\", uniqueName ? 'script.setAttribute(\"data-webpack\", dataWebpackPrefix + key);' : \"\", this._withFetchPriority ? Template.asString([\"if(fetchPriority) {\", Template.indent('script.setAttribute(\"fetchpriority\", fetchPriority);'), \"}\"]) : \"\", `script.src = ${this._withCreateScriptUrl ? `${RuntimeGlobals.createScriptUrl}(url)` : \"url\"};`, crossOriginLoading ? crossOriginLoading === \"use-credentials\" ? 'script.crossOrigin = \"use-credentials\";' : Template.asString([\"if (script.src.indexOf(window.location.origin + '/') !== 0) {\", Template.indent(`script.crossOrigin = ${JSON.stringify(crossOriginLoading)};`), \"}\"]) : \"\"]);\n    return Template.asString([\"var inProgress = {};\", uniqueName ? `var dataWebpackPrefix = ${JSON.stringify(uniqueName + \":\")};` : \"// data-webpack is not used as build has no uniqueName\", \"// loadScript function to load a script via script tag\", `${fn} = ${runtimeTemplate.basicFunction(`url, done, key, chunkId${this._withFetchPriority ? \", fetchPriority\" : \"\"}`, [\"if(inProgress[url]) { inProgress[url].push(done); return; }\", \"var script, needAttach;\", \"if(key !== undefined) {\", Template.indent(['var scripts = document.getElementsByTagName(\"script\");', \"for(var i = 0; i < scripts.length; i++) {\", Template.indent([\"var s = scripts[i];\", `if(s.getAttribute(\"src\") == url${uniqueName ? ' || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key' : \"\"}) { script = s; break; }`]), \"}\"]), \"}\", \"if(!script) {\", Template.indent([\"needAttach = true;\", createScript.call(code, /** @type {Chunk} */this.chunk)]), \"}\", \"inProgress[url] = [done];\", \"var onScriptComplete = \" + runtimeTemplate.basicFunction(\"prev, event\", Template.asString([\"// avoid mem leaks in IE.\", \"script.onerror = script.onload = null;\", \"clearTimeout(timeout);\", \"var doneFns = inProgress[url];\", \"delete inProgress[url];\", \"script.parentNode && script.parentNode.removeChild(script);\", `doneFns && doneFns.forEach(${runtimeTemplate.returningFunction(\"fn(event)\", \"fn\")});`, \"if(prev) return prev(event);\"])), `var timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), ${loadTimeout});`, \"script.onerror = onScriptComplete.bind(null, script.onerror);\", \"script.onload = onScriptComplete.bind(null, script.onload);\", \"needAttach && document.head.appendChild(script);\"])};`]);\n  }\n}\nmodule.exports = LoadScriptRuntimeModule;","map":{"version":3,"names":["SyncWaterfallHook","require","Compilation","RuntimeGlobals","Template","HelperRuntimeModule","compilationHooksMap","WeakMap","LoadScriptRuntimeModule","getCompilationHooks","compilation","TypeError","hooks","get","undefined","createScript","set","constructor","withCreateScriptUrl","withFetchPriority","_withCreateScriptUrl","_withFetchPriority","generate","runtimeTemplate","outputOptions","scriptType","chunkLoadTimeout","loadTimeout","crossOriginLoading","uniqueName","charset","fn","loadScript","code","asString","JSON","stringify","scriptNonce","indent","createScriptUrl","basicFunction","call","chunk","returningFunction","module","exports"],"sources":["/Volumes/storage/projects/project-mcnt/node_modules/webpack/lib/runtime/LoadScriptRuntimeModule.js"],"sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n*/\n\n\"use strict\";\n\nconst { SyncWaterfallHook } = require(\"tapable\");\nconst Compilation = require(\"../Compilation\");\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst Template = require(\"../Template\");\nconst HelperRuntimeModule = require(\"./HelperRuntimeModule\");\n\n/** @typedef {import(\"../Chunk\")} Chunk */\n/** @typedef {import(\"../Compiler\")} Compiler */\n\n/**\n * @typedef {Object} LoadScriptCompilationHooks\n * @property {SyncWaterfallHook<[string, Chunk]>} createScript\n */\n\n/** @type {WeakMap<Compilation, LoadScriptCompilationHooks>} */\nconst compilationHooksMap = new WeakMap();\n\nclass LoadScriptRuntimeModule extends HelperRuntimeModule {\n\t/**\n\t * @param {Compilation} compilation the compilation\n\t * @returns {LoadScriptCompilationHooks} hooks\n\t */\n\tstatic getCompilationHooks(compilation) {\n\t\tif (!(compilation instanceof Compilation)) {\n\t\t\tthrow new TypeError(\n\t\t\t\t\"The 'compilation' argument must be an instance of Compilation\"\n\t\t\t);\n\t\t}\n\t\tlet hooks = compilationHooksMap.get(compilation);\n\t\tif (hooks === undefined) {\n\t\t\thooks = {\n\t\t\t\tcreateScript: new SyncWaterfallHook([\"source\", \"chunk\"])\n\t\t\t};\n\t\t\tcompilationHooksMap.set(compilation, hooks);\n\t\t}\n\t\treturn hooks;\n\t}\n\n\t/**\n\t * @param {boolean=} withCreateScriptUrl use create script url for trusted types\n\t * @param {boolean=} withFetchPriority use `fetchPriority` attribute\n\t */\n\tconstructor(withCreateScriptUrl, withFetchPriority) {\n\t\tsuper(\"load script\");\n\t\tthis._withCreateScriptUrl = withCreateScriptUrl;\n\t\tthis._withFetchPriority = withFetchPriority;\n\t}\n\n\t/**\n\t * @returns {string | null} runtime code\n\t */\n\tgenerate() {\n\t\tconst compilation = /** @type {Compilation} */ (this.compilation);\n\t\tconst { runtimeTemplate, outputOptions } = compilation;\n\t\tconst {\n\t\t\tscriptType,\n\t\t\tchunkLoadTimeout: loadTimeout,\n\t\t\tcrossOriginLoading,\n\t\t\tuniqueName,\n\t\t\tcharset\n\t\t} = outputOptions;\n\t\tconst fn = RuntimeGlobals.loadScript;\n\n\t\tconst { createScript } =\n\t\t\tLoadScriptRuntimeModule.getCompilationHooks(compilation);\n\n\t\tconst code = Template.asString([\n\t\t\t\"script = document.createElement('script');\",\n\t\t\tscriptType ? `script.type = ${JSON.stringify(scriptType)};` : \"\",\n\t\t\tcharset ? \"script.charset = 'utf-8';\" : \"\",\n\t\t\t`script.timeout = ${/** @type {number} */ (loadTimeout) / 1000};`,\n\t\t\t`if (${RuntimeGlobals.scriptNonce}) {`,\n\t\t\tTemplate.indent(\n\t\t\t\t`script.setAttribute(\"nonce\", ${RuntimeGlobals.scriptNonce});`\n\t\t\t),\n\t\t\t\"}\",\n\t\t\tuniqueName\n\t\t\t\t? 'script.setAttribute(\"data-webpack\", dataWebpackPrefix + key);'\n\t\t\t\t: \"\",\n\t\t\tthis._withFetchPriority\n\t\t\t\t? Template.asString([\n\t\t\t\t\t\t\"if(fetchPriority) {\",\n\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t'script.setAttribute(\"fetchpriority\", fetchPriority);'\n\t\t\t\t\t\t),\n\t\t\t\t\t\t\"}\"\n\t\t\t\t\t])\n\t\t\t\t: \"\",\n\t\t\t`script.src = ${\n\t\t\t\tthis._withCreateScriptUrl\n\t\t\t\t\t? `${RuntimeGlobals.createScriptUrl}(url)`\n\t\t\t\t\t: \"url\"\n\t\t\t};`,\n\t\t\tcrossOriginLoading\n\t\t\t\t? crossOriginLoading === \"use-credentials\"\n\t\t\t\t\t? 'script.crossOrigin = \"use-credentials\";'\n\t\t\t\t\t: Template.asString([\n\t\t\t\t\t\t\t\"if (script.src.indexOf(window.location.origin + '/') !== 0) {\",\n\t\t\t\t\t\t\tTemplate.indent(\n\t\t\t\t\t\t\t\t`script.crossOrigin = ${JSON.stringify(crossOriginLoading)};`\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t])\n\t\t\t\t: \"\"\n\t\t]);\n\n\t\treturn Template.asString([\n\t\t\t\"var inProgress = {};\",\n\t\t\tuniqueName\n\t\t\t\t? `var dataWebpackPrefix = ${JSON.stringify(uniqueName + \":\")};`\n\t\t\t\t: \"// data-webpack is not used as build has no uniqueName\",\n\t\t\t\"// loadScript function to load a script via script tag\",\n\t\t\t`${fn} = ${runtimeTemplate.basicFunction(\n\t\t\t\t`url, done, key, chunkId${\n\t\t\t\t\tthis._withFetchPriority ? \", fetchPriority\" : \"\"\n\t\t\t\t}`,\n\t\t\t\t[\n\t\t\t\t\t\"if(inProgress[url]) { inProgress[url].push(done); return; }\",\n\t\t\t\t\t\"var script, needAttach;\",\n\t\t\t\t\t\"if(key !== undefined) {\",\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t'var scripts = document.getElementsByTagName(\"script\");',\n\t\t\t\t\t\t\"for(var i = 0; i < scripts.length; i++) {\",\n\t\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\t\"var s = scripts[i];\",\n\t\t\t\t\t\t\t`if(s.getAttribute(\"src\") == url${\n\t\t\t\t\t\t\t\tuniqueName\n\t\t\t\t\t\t\t\t\t? ' || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key'\n\t\t\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t\t\t}) { script = s; break; }`\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t\"}\"\n\t\t\t\t\t]),\n\t\t\t\t\t\"}\",\n\t\t\t\t\t\"if(!script) {\",\n\t\t\t\t\tTemplate.indent([\n\t\t\t\t\t\t\"needAttach = true;\",\n\t\t\t\t\t\tcreateScript.call(code, /** @type {Chunk} */ (this.chunk))\n\t\t\t\t\t]),\n\t\t\t\t\t\"}\",\n\t\t\t\t\t\"inProgress[url] = [done];\",\n\t\t\t\t\t\"var onScriptComplete = \" +\n\t\t\t\t\t\truntimeTemplate.basicFunction(\n\t\t\t\t\t\t\t\"prev, event\",\n\t\t\t\t\t\t\tTemplate.asString([\n\t\t\t\t\t\t\t\t\"// avoid mem leaks in IE.\",\n\t\t\t\t\t\t\t\t\"script.onerror = script.onload = null;\",\n\t\t\t\t\t\t\t\t\"clearTimeout(timeout);\",\n\t\t\t\t\t\t\t\t\"var doneFns = inProgress[url];\",\n\t\t\t\t\t\t\t\t\"delete inProgress[url];\",\n\t\t\t\t\t\t\t\t\"script.parentNode && script.parentNode.removeChild(script);\",\n\t\t\t\t\t\t\t\t`doneFns && doneFns.forEach(${runtimeTemplate.returningFunction(\n\t\t\t\t\t\t\t\t\t\"fn(event)\",\n\t\t\t\t\t\t\t\t\t\"fn\"\n\t\t\t\t\t\t\t\t)});`,\n\t\t\t\t\t\t\t\t\"if(prev) return prev(event);\"\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t),\n\t\t\t\t\t`var timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), ${loadTimeout});`,\n\t\t\t\t\t\"script.onerror = onScriptComplete.bind(null, script.onerror);\",\n\t\t\t\t\t\"script.onload = onScriptComplete.bind(null, script.onload);\",\n\t\t\t\t\t\"needAttach && document.head.appendChild(script);\"\n\t\t\t\t]\n\t\t\t)};`\n\t\t]);\n\t}\n}\n\nmodule.exports = LoadScriptRuntimeModule;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}